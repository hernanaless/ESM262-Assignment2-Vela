---
title: "ESM262-Assignment2-Vela"
author: "Alejandro Vela"
date: "5/14/2018"
output:
  html_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
## Part 1: Import and Tidy

### Part 1-1: Load Libraries


```{r load_libraries}

library(plyr)
library(tidyverse)
library(readr)
library(tibble)
library(dplyr)
library(tidyr)
library(DBI)
library(sqldf)


```
### Part 1-2: Import Data

```{r}
# Import the data we want to store in the SQL database
data = read.csv("Gazetteer.csv", sep="|")
```

### Part 1-3: Connect to our Database

```{r}
# Connect to our database
db<- dbConnect(SQLite(), dbname="gaz.db")
```

### Part 1-4: Write the Data in our Database

```{r}
# Write the data to our database
dbWriteTable(db, "data", data)
```

### Part 2-1: Display Highest Count of Feature Name

```{r}
# Query our database to display us the highest count of feature Name
dbGetQuery(db, 'SELECT Name FROM data GROUP BY Name ORDER BY COUNT(*) DESC LIMIT 1')
```
### Part 2-2: Display Lowest Count of Feature Class

```{r}
# Query our database to display us the lowest count of feature Class
dbGetQuery(db, 'SELECT Class FROM data GROUP BY Class ORDER BY COUNT(*) ASC LIMIT 1')
```

### Part 2-3: Display Center of Each County

```{r}
# Display center of each county
dbGetQuery(db, 'SELECT County, AVG(Latitude_DEC) AS 
           "Approximate Center Latitude", AVG(Longitude_DEC) AS
           "Approximate Center Longitude" FROM data GROUP BY County')

```
### Part 2-4: Display all Features if they are ManMande or Natural

```{r}
# Import feature class from previous exercises and join it to our db and store the values of Man/Nature in variable feature
feature<-read.table("feature.txt", header = TRUE)
dbWriteTable(db, "feature", feature)
features<-dbGetQuery(db, "SELECT County, data.Class, 
                     feature.Feature FROM data LEFT JOIN feature ON data.Class = feature.Class")[,3]

# Display count of natural and man made features respectively
table(unlist(features))

# Display total number of natural and man made features
length(features)
```







